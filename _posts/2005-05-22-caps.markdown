---
layout: post
status: publish
published: true
title: iBook caps lock as control in Linux
author: Hans
author_login: fugalh
author_email: hans@fugal.net
author_url: http://hans.fugal.net/
wordpress_id: 76
wordpress_url: urn:uuid:e39dc24f-d532-4eb5-9f8e-d72999990d56
date: 2005-05-22 09:49:03.000000000 -07:00
tags:
- mac
comments:
- id: 1443
  author: Hans
  author_email: ''
  author_url: ''
  date: '2007-05-12 21:22:53 -0700'
  date_gmt: ''
  content: |-
    <p>Update: Unfortunately I am no longer an XMission customer, so the patch has moved to <a href="http://hans.fugal.net/src/capslock/" rel="nofollow">http://hans.fugal.net/src/capslock/</a>.</p>

    <p>May you always control your caps.</p>
---
<p>The short version of this saga is here:
<a href="http://hans.fugal.net/src/capslock/">http://www.xmission.com/~fugalh/capslock/</a></p>

<p>ADB keyboards (like the one in my iBook) send the following events
(oversimplified) on caps lock presses:</p>

<pre><code>caps pressed on:  0x39
caps released:    0xff
caps pressed off: 0xff
caps released:    0xb9
</code></pre>

<p>Those 0xff events are not true caps lock events, they are some sort of special
not-quite event. They probably aren't even mentioned in the spec. In any case,
the linux kernel uses this logic to deal with this <em>interesting</em> hardware
quirk: on 0x39 and 0xb9 both, generate both a key press and key release event,
and do nothing for the 0xff events (or at least, nothing related to caps lock).
This makes caps lock work perfectly, but it also makes it impossible to remap
caps lock to a modifier because there is no way to hold down the key.</p>

<p>But in practice those 0xff events are mostly generated by caps lock. This is
how uControl and Tiger remap caps lock to control. The patch at the above link
will give linux the ability to do the same thing, with the same
<a href="http://gnufoo.org/ucontrol/ucontrol.html#features">caveats</a>. The only
difference is that that patch is changing the kernel behavior for caps lock,
not only when caps lock is remapped, so if you <em>don't</em> remap caps lock you
might end up with an inverted caps lock occasionally. Depending on your
personality, that may really bug you. Personally, I can't see the caps lock
light through my hands anyway, so it doesn't bother me. (Not that I'd ever have
caps lock as caps lock&hellip;)</p>

<p>And now you know the rest of the story.</p>
